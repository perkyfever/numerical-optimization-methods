#include "stepper.h"

struct TestFunction : BaseFunction {
    Arg operator()(const double a_t, const Arg &a_y, const Arg &a_dy) override {
        return (a_y + a_dy * a_dy) * 2.0;
    }
};

int main() {
    TestFunction func;
    EverhartStepper<50> stepper(func);

    double test_t = 0;
    double test_h = 1e-3;
    Arg test_y = Arg(1, 2, 3);
    Arg test_dy = Arg(3, 2, 1);

    for (int i = 0; i < 100; ++i) {
        auto [next_y, next_dy] = stepper.MakeStep(test_h, test_t, test_y, test_dy);
        test_t += test_h;
        test_y = next_y, test_dy = next_dy;
        std::cout << "y(t) = " << test_y;
        std::cout << "y'(t) = " << test_dy;
    }

//    y(t) = (1.00301, 2.00201, 3.001)
//    y'(t) = (3.02012, 2.01205, 1.00802)
//    y(t) = (1.00604, 2.00402, 3.00202)
//    y'(t) = (3.0405, 2.0242, 1.01607)
//    y(t) = (1.00909, 2.00605, 3.00304)
//    y'(t) = (3.06113, 2.03646, 1.02415)
//    y(t) = (1.01216, 2.0081, 3.00406)
//    y'(t) = (3.08202, 2.04881, 1.03228)
//    y(t) = (1.01526, 2.01015, 3.0051)
//    y'(t) = (3.10317, 2.06128, 1.04043)
//    y(t) = (1.01837, 2.01222, 3.00615)
//    y'(t) = (3.1246, 2.07385, 1.04863)
//    y(t) = (1.0215, 2.0143, 3.0072)
//    y'(t) = (3.1463, 2.08653, 1.05686)
//    y(t) = (1.02466, 2.01639, 3.00826)
//    y'(t) = (3.16828, 2.09932, 1.06512)
//    y(t) = (1.02784, 2.0185, 3.00933)
//    y'(t) = (3.19055, 2.11223, 1.07343)
//    y(t) = (1.03104, 2.02062, 3.01041)
//    y'(t) = (3.21311, 2.12524, 1.08177)
//    y(t) = (1.03427, 2.02275, 3.01149)
//    y'(t) = (3.23597, 2.13838, 1.09015)
//    y(t) = (1.03752, 2.02489, 3.01259)
//    y'(t) = (3.25913, 2.15162, 1.09857)
//    y(t) = (1.04079, 2.02705, 3.01369)
//    y'(t) = (3.28261, 2.16499, 1.10703)
//    y(t) = (1.04408, 2.02922, 3.0148)
//    y'(t) = (3.3064, 2.17848, 1.11553)
//    y(t) = (1.0474, 2.03141, 3.01592)
//    y'(t) = (3.33051, 2.19209, 1.12407)
//    y(t) = (1.05074, 2.03361, 3.01705)
//    y'(t) = (3.35496, 2.20583, 1.13264)
//    y(t) = (1.05411, 2.03582, 3.01819)
//    y'(t) = (3.37974, 2.21969, 1.14126)
//    y(t) = (1.0575, 2.03805, 3.01933)
//    y'(t) = (3.40487, 2.23368, 1.14993)
//    y(t) = (1.06092, 2.04029, 3.02049)
//    y'(t) = (3.43035, 2.2478, 1.15863)
//    y(t) = (1.06436, 2.04254, 3.02165)
//    y'(t) = (3.45618, 2.26205, 1.16738)
//    y(t) = (1.06783, 2.04481, 3.02282)
//    y'(t) = (3.48238, 2.27644, 1.17617)
//    y(t) = (1.07133, 2.0471, 3.024)
//    y'(t) = (3.50896, 2.29096, 1.185)
//    y(t) = (1.07485, 2.04939, 3.02519)
//    y'(t) = (3.53592, 2.30562, 1.19388)
//    y(t) = (1.0784, 2.05171, 3.02639)
//    y'(t) = (3.56327, 2.32042, 1.20281)
//    y(t) = (1.08198, 2.05404, 3.0276)
//    y'(t) = (3.59102, 2.33537, 1.21178)
//    y(t) = (1.08558, 2.05638, 3.02881)
//    y'(t) = (3.61918, 2.35045, 1.22079)
//    y(t) = (1.08921, 2.05874, 3.03004)
//    y'(t) = (3.64776, 2.36569, 1.22985)
//    y(t) = (1.09288, 2.06111, 3.03127)
//    y'(t) = (3.67677, 2.38108, 1.23896)
//    y(t) = (1.09657, 2.0635, 3.03252)
//    y'(t) = (3.70621, 2.39661, 1.24812)
//    y(t) = (1.10029, 2.0659, 3.03377)
//    y'(t) = (3.7361, 2.41231, 1.25732)
//    y(t) = (1.10404, 2.06832, 3.03503)
//    y'(t) = (3.76644, 2.42815, 1.26658)
//    y(t) = (1.10782, 2.07076, 3.0363)
//    y'(t) = (3.79726, 2.44416, 1.27588)
//    y(t) = (1.11164, 2.07321, 3.03758)
//    y'(t) = (3.82855, 2.46033, 1.28523)
//    y(t) = (1.11548, 2.07568, 3.03887)
//    y'(t) = (3.86034, 2.47667, 1.29464)
//    y(t) = (1.11936, 2.07817, 3.04017)
//    y'(t) = (3.89263, 2.49317, 1.30409)
//    y(t) = (1.12326, 2.08067, 3.04148)
//    y'(t) = (3.92543, 2.50985, 1.3136)
//    y(t) = (1.12721, 2.08318, 3.0428)
//    y'(t) = (3.95876, 2.52669, 1.32316)
//    y(t) = (1.13118, 2.08572, 3.04413)
//    y'(t) = (3.99263, 2.54372, 1.33277)
//    y(t) = (1.13519, 2.08827, 3.04546)
//    y'(t) = (4.02705, 2.56092, 1.34244)
//    y(t) = (1.13924, 2.09084, 3.04681)
//    y'(t) = (4.06204, 2.5783, 1.35217)
//    y(t) = (1.14332, 2.09343, 3.04817)
//    y'(t) = (4.09761, 2.59587, 1.36194)
//    y(t) = (1.14743, 2.09603, 3.04953)
//    y'(t) = (4.13377, 2.61363, 1.37178)
//    y(t) = (1.15158, 2.09866, 3.05091)
//    y'(t) = (4.17055, 2.63158, 1.38167)
//    y(t) = (1.15577, 2.1013, 3.0523)
//    y'(t) = (4.20796, 2.64973, 1.39162)
//    y(t) = (1.16, 2.10396, 3.05369)
//    y'(t) = (4.246, 2.66807, 1.40162)
//    y(t) = (1.16427, 2.10663, 3.0551)
//    y'(t) = (4.28471, 2.68662, 1.41169)
//    y(t) = (1.16857, 2.10933, 3.05652)
//    y'(t) = (4.3241, 2.70537, 1.42182)
//    y(t) = (1.17291, 2.11204, 3.05795)
//    y'(t) = (4.36418, 2.72433, 1.432)
//    y(t) = (1.1773, 2.11478, 3.05938)
//    y'(t) = (4.40498, 2.74351, 1.44225)
//    y(t) = (1.18172, 2.11753, 3.06083)
//    y'(t) = (4.44651, 2.7629, 1.45256)
//    y(t) = (1.18619, 2.1203, 3.06229)
//    y'(t) = (4.48879, 2.78251, 1.46293)
//    y(t) = (1.1907, 2.1231, 3.06376)
//    y'(t) = (4.53185, 2.80235, 1.47337)
//    y(t) = (1.19526, 2.12591, 3.06523)
//    y'(t) = (4.57571, 2.82242, 1.48387)
//    y(t) = (1.19985, 2.12874, 3.06672)
//    y'(t) = (4.62038, 2.84272, 1.49444)
//    y(t) = (1.2045, 2.13159, 3.06822)
//    y'(t) = (4.6659, 2.86326, 1.50507)
//    y(t) = (1.20919, 2.13447, 3.06973)
//    y'(t) = (4.71229, 2.88404, 1.51577)
//    y(t) = (1.21392, 2.13736, 3.07125)
//    y'(t) = (4.75956, 2.90507, 1.52654)
//    y(t) = (1.21871, 2.14028, 3.07279)
//    y'(t) = (4.80776, 2.92634, 1.53738)
//    y(t) = (1.22354, 2.14321, 3.07433)
//    y'(t) = (4.8569, 2.94788, 1.54829)
//    y(t) = (1.22842, 2.14617, 3.07588)
//    y'(t) = (4.90701, 2.96968, 1.55927)
//    y(t) = (1.23335, 2.14915, 3.07745)
//    y'(t) = (4.95813, 2.99174, 1.57032)
//    y(t) = (1.23834, 2.15216, 3.07902)
//    y'(t) = (5.01028, 3.01408, 1.58144)
//    y(t) = (1.24337, 2.15518, 3.08061)
//    y'(t) = (5.0635, 3.03669, 1.59264)
//    y(t) = (1.24846, 2.15823, 3.08221)
//    y'(t) = (5.11782, 3.05959, 1.60391)
//    y(t) = (1.25361, 2.1613, 3.08382)
//    y'(t) = (5.17327, 3.08277, 1.61526)
//    y(t) = (1.25881, 2.1644, 3.08544)
//    y'(t) = (5.22989, 3.10624, 1.62668)
//    y(t) = (1.26407, 2.16751, 3.08707)
//    y'(t) = (5.28771, 3.13002, 1.63818)
//    y(t) = (1.26939, 2.17066, 3.08872)
//    y'(t) = (5.34679, 3.1541, 1.64976)
//    y(t) = (1.27476, 2.17382, 3.09037)
//    y'(t) = (5.40715, 3.1785, 1.66142)
//    y(t) = (1.2802, 2.17701, 3.09204)
//    y'(t) = (5.46884, 3.20321, 1.67317)
//    y(t) = (1.2857, 2.18023, 3.09372)
//    y'(t) = (5.53191, 3.22825, 1.68499)
//    y(t) = (1.29127, 2.18347, 3.09541)
//    y'(t) = (5.5964, 3.25362, 1.6969)
//    y(t) = (1.29689, 2.18674, 3.09711)
//    y'(t) = (5.66236, 3.27933, 1.70889)
//    y(t) = (1.30259, 2.19003, 3.09883)
//    y'(t) = (5.72984, 3.30538, 1.72097)
//    y(t) = (1.30835, 2.19335, 3.10055)
//    y'(t) = (5.7989, 3.33179, 1.73313)
//    y(t) = (1.31419, 2.19669, 3.10229)
//    y'(t) = (5.86959, 3.35856, 1.74539)
//    y(t) = (1.32009, 2.20006, 3.10404)
//    y'(t) = (5.94197, 3.3857, 1.75773)
//    y(t) = (1.32607, 2.20346, 3.10581)
//    y'(t) = (6.0161, 3.41321, 1.77016)
//    y(t) = (1.33213, 2.20689, 3.10758)
//    y'(t) = (6.09206, 3.44111, 1.78268)
//    y(t) = (1.33826, 2.21035, 3.10937)
//    y'(t) = (6.16989, 3.46941, 1.7953)
//    y(t) = (1.34447, 2.21383, 3.11118)
//    y'(t) = (6.24969, 3.4981, 1.80802)
//    y(t) = (1.35076, 2.21734, 3.11299)
//    y'(t) = (6.33152, 3.52721, 1.82082)
//    y(t) = (1.35713, 2.22088, 3.11482)
//    y'(t) = (6.41545, 3.55674, 1.83373)
//    y(t) = (1.36359, 2.22446, 3.11666)
//    y'(t) = (6.50159, 3.5867, 1.84673)
//    y(t) = (1.37014, 2.22806, 3.11851)
//    y'(t) = (6.59, 3.6171, 1.85984)
//    y(t) = (1.37677, 2.23169, 3.12038)
//    y'(t) = (6.68079, 3.64794, 1.87304)
//    y(t) = (1.3835, 2.23535, 3.12226)
//    y'(t) = (6.77405, 3.67925, 1.88635)
//    y(t) = (1.39032, 2.23905, 3.12415)
//    y'(t) = (6.86989, 3.71104, 1.89977)
//    y(t) = (1.39724, 2.24278, 3.12606)
//    y'(t) = (6.96841, 3.7433, 1.91329)
//    y(t) = (1.40426, 2.24654, 3.12798)
//    y'(t) = (7.06973, 3.77606, 1.92691)
//    y(t) = (1.41138, 2.25033, 3.12991)
//    y'(t) = (7.17396, 3.80932, 1.94065)
//    y(t) = (1.41861, 2.25416, 3.13186)
//    y'(t) = (7.28125, 3.8431, 1.9545)
//    y(t) = (1.42594, 2.25802, 3.13382)
//    y'(t) = (7.39172, 3.87742, 1.96846)
//    y(t) = (1.43339, 2.26191, 3.13579)
//    y'(t) = (7.50552, 3.91227, 1.98253)
//    y(t) = (1.44095, 2.26584, 3.13778)
//    y'(t) = (7.6228, 3.94769, 1.99672)
//    y(t) = (1.44864, 2.26981, 3.13979)
//    y'(t) = (7.74373, 3.98368, 2.01103)
//    y(t) = (1.45644, 2.27381, 3.14181)
//    y'(t) = (7.86848, 4.02025, 2.02546)
//    y(t) = (1.46438, 2.27785, 3.14384)
//    y'(t) = (7.99723, 4.05742, 2.04001)
//    y(t) = (1.47244, 2.28192, 3.14589)
//    y'(t) = (8.13019, 4.09521, 2.05468)
//    y(t) = (1.48064, 2.28604, 3.14795)
//    y'(t) = (8.26755, 4.13364, 2.06948)

    return 0;
}
